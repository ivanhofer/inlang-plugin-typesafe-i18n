var h=async(e,t,n=0)=>{let r=await e.readdir(t,{withFileTypes:!0}),s=r.filter(a=>!a.isDirectory()).map(({name:a})=>({name:a.toString(),folder:""})),i=r.filter(a=>a.isDirectory());if(n)for(let a of i)s.push(...(await h(e,`${t}/${a.name}/`,n-1)).map(o=>({name:o.name.toString(),folder:a.name.toString()})));return s},k=async(e,t,n)=>{let r=n==="JavaScript"?".js":".ts";return(await h(e,t,1)).filter(({folder:i,name:a})=>i&&a===`index${r}`).map(({folder:i})=>i)},E=async e=>({baseLocale:"en",tempPath:"./node_modules/typesafe-i18n/temp-output/",outputPath:"./src/i18n/",outputFormat:"TypeScript",typesFileName:"i18n-types",utilFileName:"i18n-util",formattersTemplateFileName:"formatters",typesTemplateFileName:"custom-types",esmImports:!1,adapter:void 0,generateOnlyTypes:!1,banner:"/* eslint-disable */",runAfterGenerator:void 0,...e}),I=async e=>{let t=await e.readFile(".typesafe-i18n.json").catch(()=>"{}");return JSON.parse(t.toString())},u=async e=>{let t=await I(e);return E(t)},v=async e=>{let t=await u(e);return{base:t.baseLocale,locales:await k(e,t.outputPath,t.outputFormat)}};function d(e){return t=>n=>e({settings:t,env:n})}var P=e=>e!==void 0,j=e=>typeof e=="string",C=e=>t=>t[e],S=e=>Array.from(new Set(e)),F=e=>Object.fromEntries(Object.entries(e).map(([t,n])=>t!=="i"&&n&&n!="0"&&[t,n]).filter(Boolean)),O=e=>Object.fromEntries(Object.keys(e).map(t=>{let n=e[t];return[t,Array.isArray(n)?n.map(r=>r?.trim()):n===!!n?n:n?.trim()]})),z=e=>{let[t="",...n]=e.split("|"),[r="",s]=t.split(":"),[i,a]=r.split("?");return{k:i,i:s,n:a==="",f:n}},M=e=>!!(e.o||e.r),A=(e,t)=>{let[n,r]=e.split(":");r||(r=n,n=t);let s=r.split("|"),[i,a,o,l,c,m]=s,g=s.filter(R=>R!==void 0).length;return g===1?{k:n,r:i}:g===2?{k:n,o:i,r:a}:g===3?{k:n,z:i,o:a,r:o}:{k:n,z:i,o:a,t:o,f:l,m:c,r:m}},W=/^\{.*\}$/,L=e=>Object.fromEntries(y(e).split(",").map(t=>t.split(":")).reduce((t,n)=>n.length===2?[...t,n.map(r=>r.trim())]:(t[t.length-1][1]+=","+n[0],t),[])),w=/(\{(?:[^{}]+|\{(?:[^{}]+)*\})*\})/g,y=e=>e.substring(1,e.length-1),B=(e,t=!0,n="",r="")=>e.split(w).map(s=>{if(!s.match(w))return s;let i=y(s);if(i.startsWith("{"))return A(y(i),r);let a=z(i);return r=a.k||r,!n&&(n=r),a}).map(s=>{if(typeof s=="string")return s;s.k||(s.k=n||"0");let i=O(s);return t?F(i):i});var D=e=>e.kind==="plural",N=e=>e.kind==="parameter",_=e=>e.kind==="switch-case",b=e=>q(B(e,!1).map(V).filter(P)),V=e=>j(e)?e?G(e):void 0:M(e)?J(e):U(e),G=e=>({kind:"text",content:e}),J=({k:e,z:t,o:n,t:r,f:s,m:i,r:a})=>({kind:"plural",key:e,...t?{zero:t}:void 0,...n?{one:n}:void 0,...r?{two:r}:void 0,...s?{few:s}:void 0,...i?{many:i}:void 0,other:a}),U=({k:e,i:t,n,f:r})=>({kind:"parameter",key:e,types:t?[t]:[],optional:n||!1,transforms:(r||[]).map(X)}),X=e=>e.match(W)?{kind:"switch-case",cases:Object.entries(L(e)).map(([n,r])=>({key:n,value:r})),raw:e}:{kind:"formatter",name:e},q=e=>{let t=e.filter(N),n=e.filter(D),r={};return t.forEach(({key:s,types:i,transforms:a,optional:o})=>{let l=i.length?i:H(a);r[s]={types:S([...r[s]?.types||[],...l]).filter(P),optional:r[s]?.optional||o}}),n.forEach(({key:s})=>{r[s]?.types.length||(r[s]={types:["string","number","boolean"],optional:!1})}),Object.keys(r).forEach(s=>{r[s]?.types.length||(r[s]={types:["unknown"],optional:r[s]?.optional||!1})}),Object.entries(r).forEach(([s,i])=>{let a=t.find(o=>o.key===s);a&&(a.types=i.types,a.optional=a.optional||i.optional)}),e},H=e=>{if(!e?.length)return[];let t=e[0];return _(t)?t.cases.map(C("key")).map(r=>r==="*"?"string":`'${r}'`):[]};var p=e=>({...e,readdir:async(t,n)=>{let r=await e.readdir(t);return n?.withFileTypes?r.map(s=>({name:s,isDirectory:()=>!(s.endsWith(".ts")||s.endsWith(".js"))})):r},readFile:async t=>{let n=await e.readFile(t);return Buffer.from(n).toString()}}),f=(...e)=>e.map(t=>{for(;t.startsWith("/");)t=t.substring(1);for(;t.endsWith("/");)t=t.substring(0,t.length-1);return t}).join("/");async function $({config:e,$fs:t}){let n=p(t),r=await u(n),s=[];for(let i of e.languages){let a=await Q(n,r.outputPath,i);s.push(Y(a,i))}return s}var Q=async(e,t,n)=>{let a=(await e.readFile(f(t,`${n}/index.ts`),{encoding:"utf-8"})).split(`
`).filter(l=>!l.trim().startsWith("import ")).join(`
`).replace(/const\s\w[^\s]+\s*(:\s*\w[^\s]+\s*)=/g,(l,c)=>l.replace(c,"")).replace(/ satisfies.*\/n/g,`
`);return(await import("data:application/javascript,"+encodeURIComponent(a))).default},Y=(e,t)=>({type:"Resource",languageTag:{type:"LanguageTag",name:t},body:Object.entries(e).map(([n,r])=>x(n,r)).flat()}),x=(e,t)=>{if(typeof t=="object")return Object.entries(t).map(([r,s])=>x(`${e}.${r}`,s)).flat();let n=b(t);return{type:"Message",id:{type:"Identifier",name:e},pattern:{type:"Pattern",elements:n.map(r=>{switch(r.kind){case"parameter":return Z(r);case"text":return{type:"Text",value:r.content};case"plural":return K(r)}})}}},Z=e=>({type:"Placeholder",body:{type:"VariableReference",name:e.key,metadata:{types:e.types,optional:e.optional,transforms:e.transforms}}}),K=e=>({type:"Text",value:`{{${[e.zero,e.one,e.two,e.few,e.many,e.other].filter(Boolean).join("|")}}}`});async function T({$fs:e,config:t,resources:n}){let r=p(e),s=await u(r);for(let i of n){let a=i.languageTag.name,o=a===t.referenceLanguage,l=ee(i,o),c=o?"BaseTranslation":"Translation",m=`import type { ${c} } from '../${s.typesFileName}'
const ${a}: ${c} = ${l}

export default ${a}`;await r.writeFile(f(s.outputPath,`${a}/index.ts`),m)}}var ee=(e,t)=>{let n={};return e.body.map(r=>te(r,t)).forEach(([r,s])=>{let i=r.split("."),a=n;for(let o=0;o<i.length;o++){let l=i[o];o===i.length-1?a[l]=s:(a[l]||(a[l]={}),a=a[l])}}),JSON.stringify(n,null,3)},te=(e,t)=>[e.id.name,re(e.pattern,t)],re=(e,t)=>e.elements.map(n=>ne(n,t)).join(""),ne=(e,t)=>{switch(e.type){case"Text":return e.value;case"Placeholder":return se(e,t)}},se=({body:{name:e,metadata:t={}}},n)=>{let r=e;return n&&(t.optional&&(r+="?"),t.types?.length>0&&(t.types.length===3&&t.types.includes("string")&&t.types.includes("number")&&t.types.includes("boolean")||(r+=`:${t.types[0]}`))),t.transforms?.length>0&&(r+=`|${t.transforms.map(({name:s})=>s).join("|")}`),`{${r}}`};var ae=d(({env:e})=>({id:"ivanhofer.inlang-plugin-typesafe-i18n",async config(){let{base:t,locales:n}=await v(p(e.$fs));return{referenceLanguage:t,languages:n,readResources:({config:r})=>$({config:r,...e}),writeResources:({config:r,resources:s})=>T({config:r,resources:s,...e})}}}));export{ae as default};
/*! Bundled license information:

@inlang/core/dist/plugin/pluginBuildConfig.js:
  (*! DON'T TOP-LEVEL IMPORT ESBUILD PLUGINS. USE DYNAMIC IMPORTS. *)
  (*! See https://github.com/inlang/inlang/issues/486 *)
*/
//# sourceMappingURL=index.js.map
