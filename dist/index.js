var E=async e=>({baseLocale:"en",tempPath:"./node_modules/typesafe-i18n/temp-output/",outputPath:"./src/i18n/",outputFormat:"TypeScript",typesFileName:"i18n-types",utilFileName:"i18n-util",formattersTemplateFileName:"formatters",typesTemplateFileName:"custom-types",esmImports:!1,adapter:void 0,generateOnlyTypes:!1,banner:"/* eslint-disable */",runAfterGenerator:void 0,...e}),R=async e=>{let t=await e.readFile(".typesafe-i18n.json").catch(()=>"{}");return JSON.parse(t.toString())},u=async e=>{let t=await R(e);return E(t)};var h=async(e,t,r)=>{let a=await e.readFile(d(t,`${r}/index.ts`),{encoding:"utf-8"}).catch(()=>{});if(!a)return;let s=a.split(`
`).filter(o=>!o.trim().startsWith("import ")).join(`
`).replace(/const\s\w[^\s]+\s*(:\s*\w[^\s]+\s*)=/g,(o,c)=>o.replace(c,"")).replace(/ satisfies.*\/n/g,`
`);return(await import("data:application/javascript,"+encodeURIComponent(s))).default},m=e=>({...e,readdir:async(t,r)=>{let a=await e.readdir(t);return r?.withFileTypes?a.map(n=>({name:n,isDirectory:()=>!(n.endsWith(".ts")||n.endsWith(".js"))})):a},readFile:async t=>{let r=await e.readFile(t);return Buffer.from(r).toString()}}),d=(...e)=>e.map(t=>{for(;t.startsWith("/");)t=t.substring(1);for(;t.endsWith("/");)t=t.substring(0,t.length-1);return t}).join("/");var P=e=>e!==void 0,N=e=>typeof e=="string",C=e=>t=>t[e],B=e=>Array.from(new Set(e)),z=e=>Object.fromEntries(Object.entries(e).map(([t,r])=>t!=="i"&&r&&r!="0"&&[t,r]).filter(Boolean)),I=e=>Object.fromEntries(Object.keys(e).map(t=>{let r=e[t];return[t,Array.isArray(r)?r.map(a=>a?.trim()):r===!!r?r:r?.trim()]})),L=e=>{let[t="",...r]=e.split("|"),[a="",n]=t.split(":"),[i,s]=a.split("?");return{k:i,i:n,n:s==="",f:r}},_=e=>!!(e.o||e.r),A=(e,t)=>{let[r,a]=e.split(":");a||(a=r,r=t);let n=a.split("|"),[i,s,l,o,c,p]=n,f=n.filter(D=>D!==void 0).length;return f===1?{k:r,r:i}:f===2?{k:r,o:i,r:s}:f===3?{k:r,z:i,o:s,r:l}:{k:r,z:i,o:s,t:l,f:o,m:c,r:p}},W=/^\{.*\}$/,V=e=>Object.fromEntries(g(e).split(",").map(t=>t.split(":")).reduce((t,r)=>r.length===2?[...t,r.map(a=>a.trim())]:(t[t.length-1][1]+=","+r[0],t),[])),v=/(\{(?:[^{}]+|\{(?:[^{}]+)*\})*\})/g,g=e=>e.substring(1,e.length-1),G=(e,t=!0,r="",a="")=>e.split(v).map(n=>{if(!n.match(v))return n;let i=g(n);if(i.startsWith("{"))return A(g(i),a);let s=L(i);return a=s.k||a,!r&&(r=a),s}).map(n=>{if(typeof n=="string")return n;n.k||(n.k=r||"0");let i=I(n);return t?z(i):i});var J=e=>e.kind==="plural",U=e=>e.kind==="parameter",X=e=>e.kind==="switch-case",w=e=>K(G(e,!1).map(q).filter(P)),q=e=>N(e)?e?H(e):void 0:_(e)?Q(e):Y(e),H=e=>({kind:"text",content:e}),Q=({k:e,z:t,o:r,t:a,f:n,m:i,r:s})=>({kind:"plural",key:e,...t?{zero:t}:void 0,...r?{one:r}:void 0,...a?{two:a}:void 0,...n?{few:n}:void 0,...i?{many:i}:void 0,other:s}),Y=({k:e,i:t,n:r,f:a})=>({kind:"parameter",key:e,types:t?[t]:[],optional:r||!1,transforms:(a||[]).map(Z)}),Z=e=>e.match(W)?{kind:"switch-case",cases:Object.entries(V(e)).map(([r,a])=>({key:r,value:a})),raw:e}:{kind:"formatter",name:e},K=e=>{let t=e.filter(U),r=e.filter(J),a={};return t.forEach(({key:n,types:i,transforms:s,optional:l})=>{let o=i.length?i:ee(s);a[n]={types:B([...a[n]?.types||[],...o]).filter(P),optional:a[n]?.optional||l}}),r.forEach(({key:n})=>{a[n]?.types.length||(a[n]={types:["string","number","boolean"],optional:!1})}),Object.keys(a).forEach(n=>{a[n]?.types.length||(a[n]={types:["unknown"],optional:a[n]?.optional||!1})}),Object.entries(a).forEach(([n,i])=>{let s=t.find(l=>l.key===n);s&&(s.types=i.types,s.optional=s.optional||i.optional)}),e},ee=e=>{if(!e?.length)return[];let t=e[0];return X(t)?t.cases.map(C("key")).map(a=>a==="*"?"string":`'${a}'`):[]};var b=async({nodeishFs:e,languageTags:t})=>{let r=m(e),a=await u(r),n=(await Promise.all(t.map(async i=>{let s=await h(r,a.outputPath,i);if(s)return{languageTag:i,dictionary:s}}))).filter(Boolean);return te(n,a.baseLocale)},te=(e,t)=>{let r=[];for(let{languageTag:a,dictionary:n}of e){let i=re(n);for(let s of i){let l=r.find(({id:c})=>c===s.id);l||(l={id:s.id,selectors:[],variants:[]},r.push(l));let o=a===t;l.variants.push({languageTag:a,match:{},pattern:ae(s.value,y[s.id]??={},o)})}}return r},re=e=>Object.entries(e).map(([t,r])=>M(t,r)).flat(),M=(e,t)=>typeof t=="object"?Object.entries(t).map(([r,a])=>M(`${e}.${r}`,a)).flat():[{id:e,value:t}],y={},ae=(e,t,r)=>w(e).map(n=>{switch(n.kind){case"parameter":return ne(n,t,r);case"text":return{type:"Text",value:n.content};case"plural":return ie(n)}}),ne=(e,t,r)=>(r&&(t[e.key]={types:e.types,optional:e.optional,transforms:e.transforms}),{type:"VariableReference",name:e.key}),ie=e=>({type:"Text",value:`{{${[e.zero,e.one,e.two,e.few,e.many,e.other].filter(Boolean).join("|")}}}`});var S=se;function se(e,t,r){var a,n;if(Array.isArray(t)&&(a=t.slice(0)),typeof t=="string"&&(a=t.split(".")),typeof t=="symbol"&&(a=[t]),!Array.isArray(a))throw new Error("props arg must be an array, a string or a symbol");if(n=a.pop(),!n)return!1;T(n);for(var i;i=a.shift();)if(T(i),typeof e[i]>"u"&&(e[i]={}),e=e[i],!e||typeof e!="object")return!1;return e[n]=r,!0}function T(e){if(e=="__proto__"||e=="constructor"||e=="prototype")throw new Error("setting of prototype values not supported")}function F(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,a)}return r}function O(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?F(Object(r),!0).forEach(function(a){oe(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}function oe(e,t,r){return t=le(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function le(e){var t=ce(e,"string");return typeof t=="symbol"?t:String(t)}function ce(e,t){if(typeof e!="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var a=r.call(e,t||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var k=j({});function j(e){return t.withOptions=r=>j(O(O({},e),r)),t;function t(r,...a){let n=typeof r=="string"?[r]:r.raw,{escapeSpecialCharacters:i=Array.isArray(r)}=e,s="";for(let c=0;c<n.length;c++){let p=n[c];i&&(p=p.replace(/\\\n[ \t]*/g,"").replace(/\\`/g,"`").replace(/\\\$/g,"$").replace(/\\{/g,"{")),s+=p,c<a.length&&(s+=a[c])}let l=s.split(`
`),o=null;for(let c of l){let p=c.match(/^(\s+)\S+/);if(p){let f=p[1].length;o?o=Math.min(o,f):o=f}}if(o!==null){let c=o;s=l.map(p=>p[0]===" "||p[0]==="	"?p.slice(c):p).join(`
`)}return s.trim().replace(/\\n/g,`
`)}}var $=async({nodeishFs:e,messages:t})=>{let r=m(e),a=await u(r),n=fe(t,a.baseLocale);for(let[i,s]of Object.entries(n)){let o=i===a.baseLocale?"BaseTranslation":"Translation",c=k`
			import type { ${o} } from '../${a.typesFileName}'

			const ${i}: ${o} = ${JSON.stringify(s,null,3).split(/\n/).map(p=>"   "+p).join(`
`)}

			export default ${i}
		`;await pe(r,d(a.outputPath,i)),await r.writeFile(d(a.outputPath,`${i}/index.ts`),c)}},pe=async(e,t)=>{let r=t.split("/"),a="";for(let n of r)a+=n+"/",await e.readdir(a).catch(()=>{})||await e.mkdir(a)},fe=(e,t)=>{let r={};for(let a of e)for(let n of a.variants){let{languageTag:i,pattern:s}=n,l=r[i]??={},o=i===t;S(l,a.id,ue(s,y[a.id],o))}return r},ue=(e,t,r)=>e.map(a=>me(a,t,r)).join(""),me=(e,t,r)=>{switch(e.type){case"Text":return e.value;case"VariableReference":return de(e,t,r)}},de=({name:e},t,r)=>{let a=e,n=(t||{})[e];return r&&n&&(n.optional&&(a+="?"),n.types?.length>0&&(n.types.length===3&&n.types.includes("string")&&n.types.includes("number")&&n.types.includes("boolean")||(a+=`:${n.types[0]}`))),n?.transforms?.length>0&&(a+=`|${n.transforms.map(({name:i})=>i).join("|")}`),`{${a}}`};var x={meta:{id:"ivanhofer.plugin.typesafe-i18n",displayName:{en:"typesafe-i18n plugin"},description:{en:"A plugin for inlang that uses typesafe-i18n to read and write messages"},marketplace:{publisherName:"ivanhofer",publisherIcon:"https://github.com/ivanhofer.png",linkToReadme:{en:"https://github.com/ivanhofer/inlang-plugin-typesafe-i18n#readme"},icon:"https://raw.githubusercontent.com/ivanhofer/typesafe-i18n/main/website/static/launchericon-512-512.png",keywords:["inlang","plugin","typesafe-i18n","TypeScript"]}},loadMessages:b,saveMessages:$};var Ne={plugins:[x]};export{Ne as default};
